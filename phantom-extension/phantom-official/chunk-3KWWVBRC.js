import{E as dt,d as mt,g as lt,m as j,o as gt,q as l,t as V,v as z,w as tt,y as ft}from"./chunk-GZVOHEMO.js";import{E as pt}from"./chunk-TMK4CY5E.js";import{Dc as ct,Jb as ut,ld as G,wd as M}from"./chunk-U6X5ZLHM.js";import{$a as D,H as ot,I as nt,L as S,ac as at,fb as _,oe as st}from"./chunk-M4V43KDP.js";import{i as P,l as w}from"./chunk-46FGAK6J.js";import{d as E}from"./chunk-HG4P4WCJ.js";import{B as Z,N as H}from"./chunk-Q24656HF.js";import{r as C,t as it,w as g,z as I}from"./chunk-VU23O6LP.js";import{V as b,Y as X,ca as rt,u as U}from"./chunk-YTFWYDJ6.js";import{a as T,i as O}from"./chunk-O2FNG2JZ.js";import{f as h,h as i,m as Buffer,n as a}from"./chunk-3KENBVE7.js";i();a();i();a();var yt=({numSignatures:t,lamportsPerSignature:e,lamportBalance:r,rentExemptionMinimum:o})=>{let n=b(e).multipliedBy(t),s=r.minus(n);return b.max(s.minus(o),0)};var Gt=({balance:t,rentExemptionMinimum:e})=>{let r=yt({numSignatures:11,lamportsPerSignature:ut,lamportBalance:b(t),rentExemptionMinimum:nt(e)});return parseFloat(ot(r).toFixed(9))};i();a();i();a();var jt="https://keybase.io/_/api/1.0/user/pic_url.json",W=async t=>{let e=await P.get(`${jt}?username=${encodeURIComponent(t)}`);if(!w(e)||e.data.status?.code!==0)throw new Error("Couldn't fetch keybase user avatar");return e.data.pic_url};var zt=t=>{let e=l.keybaseUserAvatar(t);return g({enabled:!!t,queryKey:e,async queryFn(){if(!t)throw new Error("Keybase username is required");return W(t)},placeholderData:"",staleTime:1/0})};i();a();i();a();var He=new Error("Missing sender address for staking fungibles."),kt=new Error("Missing signature from waiting for staking transaction confirmation."),vt=new Error("PublicKey is required");var St=class extends Error{constructor(e){super(e)}};var Wt=async(t,e)=>await t.getSignatureStatuses([e],{searchTransactionHistory:!0});function Yt(t,e,r){let o=C(),n=l.signatureStatus(r),s=async()=>{if(!r)throw kt;let c=await Wt(t,r);return{...c,value:c.value[0]}},m=o.getQueryData(n)?.value?.confirmationStatus;return g({queryKey:n,queryFn:s,enabled:!!r&&m!=="finalized",refetchInterval:e,staleTime:1/0})}i();a();var Jt=t=>async()=>await t.getMinimumBalanceForRentExemption(S.StakeProgram.space);function $t(t){let e=l.stakeAccountMinBalance(),r=Jt(t);return g({queryKey:e,queryFn:r,placeholderData:0,staleTime:1/0})}i();a();var Zt=async(t,e,r,o="confirmed")=>await t.getInflationReward(e,r,o),te=async(t,e)=>{let r=[];e.ownerPublicKey&&r.push({memcmp:{offset:44,bytes:e.ownerPublicKey}}),e.voteAccountPublicKey&&r.push({dataSize:200},{memcmp:{offset:124,bytes:e.voteAccountPublicKey}});let o=await t.getParsedProgramAccounts(S.StakeProgram.programId,{filters:r}),n=[];if(e.fetchInflationRewards)try{n=await Zt(t,o.map(({pubkey:s})=>s))}catch(s){let u=s;!u.message.includes("RPC request timed out")&&I.captureError(u,"staking")}return o.map((s,u)=>({pubkey:s.pubkey.toString(),lamports:s.account.lamports,inflationReward:n[u]?.amount,...s.account.data.parsed}))},ee=(t,e)=>l.stakeAccounts(t,e),re=(t,e)=>()=>te(t,{ownerPublicKey:e,fetchInflationRewards:!0});function oe(t,e){let r=ee(e,t.rpcEndpoint),o=re(t,e);return g({queryKey:r,queryFn:o,placeholderData:[],staleTime:U({minutes:5})})}i();a();i();a();i();a();i();a();function Y(t,e){for(let r of e)if(r.epoch===t)return r;return null}var At=.09;function ne(t,e,r){if(t.activationEpoch===t.deactivationEpoch)return{effective:BigInt(0),activating:BigInt(0)};if(e===t.activationEpoch)return{effective:BigInt(0),activating:t.stake};if(e<t.activationEpoch)return{effective:BigInt(0),activating:BigInt(0)};let o=t.activationEpoch,n=Y(o,r);if(n!==null){let s=BigInt(0);for(;n!==null;){o++;let u=t.stake-s,m=Number(u)/Number(n.activating),d=Number(n.effective)*At,c=BigInt(Math.max(1,Math.round(m*d)));if(s+=c,s>=t.stake){s=t.stake;break}if(o>=e||o>=t.deactivationEpoch)break;n=Y(o,r)}return{effective:s,activating:t.stake-s}}else return{effective:t.stake,activating:BigInt(0)}}function bt(t,e,r){let{effective:o,activating:n}=ne(t,e,r);if(e<t.deactivationEpoch)return{effective:o,activating:n,deactivating:BigInt(0)};if(e==t.deactivationEpoch)return{effective:o,activating:BigInt(0),deactivating:o};let s=t.deactivationEpoch,u=Y(s,r);if(u!==null){let m=o;for(;u!==null&&(s++,u.deactivating!==BigInt(0));){let d=Number(m)/Number(u.deactivating),c=Number(u.effective)*At,k=BigInt(Math.max(1,Math.round(d*c)));if(m-=k,m<=0){m=BigInt(0);break}if(s>=e)break;u=Y(s,r)}return{effective:m,deactivating:m,activating:BigInt(0)}}else return{effective:BigInt(0),activating:BigInt(0),deactivating:BigInt(0)}}i();a();var ht=function(t){if(t.value===null||t.value.data instanceof Buffer)throw new Error("Account not found");let e=[];return t.value.data.parsed.info.forEach(r=>{e.push({epoch:BigInt(r.epoch),effective:BigInt(r.stakeHistory.effective),activating:BigInt(r.stakeHistory.activating),deactivating:BigInt(r.stakeHistory.deactivating)})}),e},Tt=function(t){let e=BigInt(0);if(t.value===null||t.value.data instanceof Buffer)throw new Error("Account not found");return t.value.data.parsed.type==="delegated"&&(e=BigInt(1)),{discriminant:e,meta:{rentExemptReserve:BigInt(t.value.data.parsed.info.meta.rentExemptReserve),authorized:{staker:t.value.data.parsed.info.meta.authorized.staker,withdrawer:t.value.data.parsed.info.meta.authorized.withdrawer},lockup:{unixTimestamp:BigInt(t.value.data.parsed.info.meta.lockup.unixTimestamp),epoch:BigInt(t.value.data.parsed.info.meta.lockup.epoch),custodian:t.value.data.parsed.info.meta.lockup.custodian}},stake:{delegation:{voterPubkey:t.value.data.parsed.info.stake.delegation.voterPubkey,stake:BigInt(t.value.data.parsed.info.stake.delegation.stake),activationEpoch:BigInt(t.value.data.parsed.info.stake.delegation.activationEpoch),deactivationEpoch:BigInt(t.value.data.parsed.info.stake.delegation.deactivationEpoch)},creditsObserved:BigInt(t.value.data.parsed.info.stake.creditsObserved)}}};async function B(t,e){let r=new S.PublicKey("SysvarStakeHistory1111111111111111111111111"),o=await t.getParsedAccountInfo(e);if(o===null||o.value===null)throw new Error("Account not found");let n=await t.getParsedAccountInfo(r);if(n===null)throw new Error("StakeHistory not found");let s=ht(n),u=await t.getEpochInfo(),m=Tt(o),{effective:d,activating:c,deactivating:k}=bt(m.stake.delegation,BigInt(u.epoch),s),f;k>0?f="deactivating":c>0?f="activating":d>0?f="active":f="inactive";let A=BigInt(o.value.lamports)-d-m.meta.rentExemptReserve;return{state:f,active:Number(d),inactive:Number(A)}}function ie(t,e){let r=l.stakeActivationData(e);return g({queryKey:r,queryFn:async()=>{if(!e)throw vt;return await B(t,new S.PublicKey(e))},enabled:!!e,staleTime:1/0})}i();a();i();a();var Pt=new Error("Failed to fetch staking APY");async function wt(){try{let t=await P.api().get("/staking/v1/apy");if(!w(t))throw Pt;let e=t.data;return j.parse(e).apy}catch{throw Pt}}var ae=()=>{let t=l.stakeApy();return g({enabled:!0,queryKey:t,gcTime:z.Short,staleTime:1/0,async queryFn(){return wt()}})};i();a();i();a();var N=h(T());i();a();i();a();var xt=new Error("Failed to fetch Average Validator APY");async function Et(){let t=await P.api().get("/staking/v1/avg-validator-apy");if(!w(t))throw xt;let e=j.safeParse(t.data);if(e.success)return e.data.apy;throw xt}var Lt=()=>{let t=l.averageValidatorApy();return g({enabled:!0,queryKey:t,gcTime:U({hours:1}),staleTime:1/0,async queryFn(){return Et()}})};i();a();i();a();var qt=new Error("Failed to fetch liquid staking supported tokens"),se=new Error("Missing supported tokens in response");async function Ut(){try{let t=await P.api().get("/liquid-staking/v1/supported-tokens");if(!w(t))throw qt;let e=gt.safeParse(t.data.supportedTokens);if(!e.success)throw se;return e.data}catch{throw qt}}var J=()=>{let t=l.liquidStakingSupportedTokens();return g({queryKey:t,staleTime:U({minutes:15}),async queryFn(){return await Ut()}})};var Ct=t=>{let e=V(y=>y.provider),r=V(y=>y.setProvider),o=V(y=>y.setFungibleToStake),n=V(y=>y.setSkipDismissRouting),s=(0,N.useMemo)(()=>t?_(G(t)):"",[t]),{data:u,isPending:m}=Lt(),d=u?u/100:null,{data:c={},isPending:k}=J(),f=(0,N.useMemo)(()=>c[s]??[],[s,c]),A=f?f[0]:void 0,L=(0,N.useCallback)((y,q)=>{if(!t||!A)return;let x=f.find(Q=>Q.stakePoolTokenMetadata.caip19===q);if(q){x&&(r(x),o(t),n(y));return}r(A),o(t),n(y)},[t,A,o,r,n,f]);return{isLoading:k||m,isSupported:f.length>0,providers:f,initLiquidStake:L,defaultProvider:A,avgValidatorApy:d,activeProvider:e}};var K=t=>{let e=mt.get(t);return Ct(e)};i();a();var Mt=h(T());var ue=({onLiquidStake:t,onNativeStake:e})=>{let r=lt,{avgValidatorApy:o,activeProvider:n}=K(D.Solana.Mainnet);return{options:(0,Mt.useMemo)(()=>[{type:"liquid",isRecommended:!0,title:E.t("stakeMethodSelectionLiquidStakingTitle"),description:E.t("stakeMethodSelectionLiquidStakingDescription",{poolTokenSymbol:n?.stakePoolTokenMetadata?.metadata?.symbol}),apy:n?E.t("stakeMethodEstApy",{apy:X(parseFloat(n.apy))}):null,disabled:!n,onClick:t??(()=>{})},{type:"native",isRecommended:!1,title:E.t("stakeMethodSelectionNativeStakingTitle"),description:E.t("stakeMethodSelectionNativeStakingDescription"),apy:o?E.t("stakeMethodEstApy",{apy:X(o)}):null,onClick:e,disabled:!1}],[o,n,t,e]),learnMoreLink:r}};i();a();i();a();var F=h(T());i();a();var Rt=h(T());var ce=t=>{let e=[];return t.ownerPublicKey&&e.push({memcmp:{offset:44,bytes:t.ownerPublicKey}}),t.voteAccountPublicKey&&e.push({dataSize:200},{memcmp:{offset:124,bytes:t.voteAccountPublicKey}}),e},Ft=async(t,e,r)=>{let o=ce(e),n=await t.getParsedProgramAccounts(S.StakeProgram.programId,{filters:o}),u=(await Promise.allSettled(n.map(c=>B(t,c.pubkey)))).map(c=>{if(c.status==="fulfilled")return c.value.state}),d=(await Promise.allSettled(n.map(c=>{let k=c.account.data?.parsed?.info?.stake?.delegation?.voter,f=r.get(k),A=f?.info?.keybaseUsername,L=f?.info?.iconUrl;return L?new Promise(y=>y(L)):A?W(A):new Promise(y=>y(null))}))).map(c=>{if(c.status==="fulfilled"&&c.value!==null)return c.value});return n.map((c,k)=>({pubkey:c.pubkey.toString(),lamports:c.account.lamports,activationState:u[k],imageUri:d[k],...c.account.data.parsed}))},It=(t,e)=>l.convertStakeAccountList(t,e),pe=(t,e,r)=>()=>Ft(t,{ownerPublicKey:e},r);function Vt(t,e,r,o=!0){let n=It(e,t.rpcEndpoint),s=pe(t,e,r);return g({queryKey:n,queryFn:s,enabled:!!e&&o,staleTime:1/0})}var $o=(t,e,r,o)=>{let n=C();return(0,Rt.useCallback)(async()=>{o&&await n.prefetchQuery({queryKey:It(e,t.rpcEndpoint),queryFn:()=>Ft(t,{ownerPublicKey:e},r)})},[n,e,t,r,o])};var me=t=>{let{data:[e]}=H(["kill-liquid-staking-convert"]),r=t?.validators,o=(0,F.useMemo)(()=>r?new Map(r.map(v=>[v.vote_account,v])):new Map,[r]),{connection:n}=ct(),{data:s}=st("solana"),{results:u,isFetched:m,isError:d}=tt(n),c=(0,F.useMemo)(()=>new Map(u.map(v=>[v.voteAccountPubkey,v])),[u]),{data:k,isLoading:f,isFetching:A,error:L,refetch:y}=Vt(n,s?.address??"",c,m||d),q=f||A,x=(0,F.useMemo)(()=>q||!k?[]:k.map(v=>le(v,c,o)).sort((v,Ht)=>v.lamports>Ht.lamports?-1:1),[q,k,c,o]),Q=(0,F.useMemo)(()=>x.filter(v=>v.eligible),[x]),_t=(0,F.useMemo)(()=>x.filter(v=>!v.eligible),[x]);return t?.stakePoolTokenMetadata.caip19===M?{hasConvertibleStakeAccounts:!1,eligibleStakeAccounts:[],inelegibleStakeAccounts:[],isLoadingList:!1,error:null,refetch:()=>{}}:{hasConvertibleStakeAccounts:!e&&Q.length>0,eligibleStakeAccounts:Q,inelegibleStakeAccounts:_t,isLoadingList:q,error:L,refetch:y}},le=(t,e,r)=>{let o=ft(t,r),n=ge(t,e),s=t.lamports;return{...t,amount:s,eligible:o,title:n,imageUri:t.imageUri}},ge=(t,e)=>{let r="";if(t.type==="delegated"){let{voter:o}=t.info.stake.delegation,n=e.get(o),s=n?.info?.keybaseUsername;r=n?.info?.name??s??at(o)}else t.type==="initialized"&&(r=t.pubkey);return r};i();a();var Bt=h(T());function fe(t){return typeof t=="string"?t:t?_(G(t)):""}var de=t=>{let e=fe(t),{data:[r]}=H(["enable-psol-staking"]),{data:o={}}=J(),n=(0,Bt.useMemo)(()=>!!Object.values(o).flat().find(u=>u.stakePoolTokenMetadata.caip19===e),[e,o]);return e===M?r&&n:n};i();a();var Ot=h(T());i();a();var $=h(T());i();a();function Nt({key:t,queryKey:e,defaultValue:r=null}){let o=Z();return g({enabled:!0,queryKey:e,gcTime:z.Long,staleTime:1/0,async queryFn(){try{return await o.get(t)}catch(n){return n instanceof Error&&I.captureError(n,"staking"),r}}})}function Kt({key:t,queryKey:e}){let r=Z(),o=C();return it({async mutationFn(n){try{return await r.set(t,n)}catch(s){s instanceof Error&&I.captureError(s,"staking");return}},async onMutate(n){await o.cancelQueries({queryKey:e});let s=o.getQueryData(e);return o.setQueryData(e,n),{previousValue:s}},onError(n,s,u){o.setQueryData(e,u?.previousValue)}})}var ye=O.object({convert:O.boolean(),mint:O.boolean()}),et={convert:!1,mint:!1},Se=JSON.stringify(et),Qt=()=>{let{data:t}=Nt({key:"featureUsed",queryKey:l.featureUsed(),defaultValue:Se}),e=(0,$.useMemo)(()=>{if(!t)return et;let n=ye.safeParse(JSON.parse(t));return n.success?n.data:et},[t]),{mutateAsync:r}=Kt({key:"featureUsed",queryKey:l.featureUsed()}),o=(0,$.useCallback)(async n=>{let s={...e,...n};await r(JSON.stringify(s))},[r,e]);return{usageState:e,setUsageState:o}};var ke=({method:t,goToInfoPage:e,goToInitFlowPage:r})=>{let{usageState:o}=Qt();return(0,Ot.useCallback)(()=>{o[t]?r():e()},[e,r,t,o])};i();a();var Dt=h(T());var ve=1;function Ae(t,e,r=5){let o=t.isLessThan(1)?new b(1):t,n=o.times(Math.pow(1+e,r));return[o,n]}function be(){let{activeProvider:t,initLiquidStake:e}=K(D.Solana.Mainnet);(0,Dt.useEffect)(()=>{e(void 0,M)},[e]);let{data:r}=pt();if(!r||!t?.apy)return{shouldHide:!0,initialTokens:new b(0),futureTokens:new b(0),apy:0,formattedApy:"0%"};let o=rt(r.totalQuantityString,r.decimals),n=dt(t),s=o.isLessThan(ve)||!n,u=parseFloat(t.apy),[m,d]=Ae(o,u),c=`${(u*100).toFixed(2)}%`;return{shouldHide:s,initialTokens:m,futureTokens:d,apy:u,formattedApy:c}}i();a();export{Gt as a,zt as b,He as c,St as d,Yt as e,$t as f,oe as g,ie as h,ae as i,$o as j,me as k,de as l,Ct as m,K as n,Qt as o,ke as p,ue as q,be as r};
//# sourceMappingURL=chunk-3KWWVBRC.js.map
