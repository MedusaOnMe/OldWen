import{i as Gr,r as Ee,t as ve,w as oe,z as x}from"./chunk-VU23O6LP.js";import{i as Kt,u as ge}from"./chunk-YTFWYDJ6.js";import{$ as zt,P as Jt,R as V,a as Vr,ba as $t,i as l}from"./chunk-O2FNG2JZ.js";import{c as b,f as ne,h as a,i as p,j as Qr,l as Wt,m as Buffer,n as u}from"./chunk-3KENBVE7.js";var pe=b(Le=>{"use strict";a();u();Object.defineProperty(Le,"__esModule",{value:!0});Le.AppAuthError=void 0;var vn=function(){function t(e,r){this.message=e,this.extras=r}return t}();Le.AppAuthError=vn});var Ce=b(L=>{"use strict";a();u();Object.defineProperty(L,"__esModule",{value:!0});L.DefaultCrypto=L.textEncodeLite=L.urlSafe=L.bufferToString=void 0;var _n=Qr(),gr=pe(),mr=typeof self<"u"&&!!self.crypto,Rn=mr&&!!self.crypto.subtle,mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Ar(t){for(var e=[],r=0;r<t.byteLength;r+=1){var n=t[r]%mt.length;e.push(mt[n])}return e.join("")}L.bufferToString=Ar;function xr(t){var e=_n.fromByteArray(new Uint8Array(t));return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}L.urlSafe=xr;function br(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}L.textEncodeLite=br;var kn=function(){function t(){}return t.prototype.generateRandom=function(e){var r=new Uint8Array(e);if(mr)self.crypto.getRandomValues(r);else for(var n=0;n<e;n+=1)r[n]=Math.random()*mt.length|0;return Ar(r)},t.prototype.deriveChallenge=function(e){return e.length<43||e.length>128?Promise.reject(new gr.AppAuthError("Invalid code length.")):Rn?new Promise(function(r,n){self.crypto.subtle.digest("SHA-256",br(e)).then(function(o){return r(xr(new Uint8Array(o)))},function(o){return n(o)})}):Promise.reject(new gr.AppAuthError("window.crypto.subtle is unavailable."))},t}();L.DefaultCrypto=kn});var At=b(v=>{"use strict";a();u();Object.defineProperty(v,"__esModule",{value:!0});v.IS_PROFILE=v.IS_LOG=v.setFlag=v.Flags=void 0;v.Flags={IS_LOG:!0,IS_PROFILE:!1};function Un(t,e){v.Flags[t]=e}v.setFlag=Un;v.IS_LOG=v.Flags.IS_LOG,v.IS_PROFILE=v.Flags.IS_PROFILE});var xe=b(M=>{"use strict";a();u();var xt=M&&M.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(M,"__esModule",{value:!0});M.profile=M.log=void 0;var wr=At();function bt(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(wr.Flags.IS_LOG){var n=e?e.length:0;n>0?console.log.apply(console,xt([t],e,!1)):console.log(t)}}M.log=bt;var In=typeof self<"u"&&!!self.performance&&!!console.profile;function Pn(t,e,r){return wr.Flags.IS_PROFILE?Sn(t,e,r):r}M.profile=Pn;function Sn(t,e,r){var n=r.value,o=n.name;return o||(o="anonymous function"),In?r.value=function(i){console.profile(o);var s=self.performance.now(),c=n.call.apply(n,xt([this||self],i,!1)),h=self.performance.now()-s;return console.log("".concat(o," took ").concat(h," ms")),console.profileEnd(),c}:r.value=function(i){bt("Profile start ".concat(o));var s=Date.now(),c=n.call.apply(n,xt([this||self],i,!1)),h=Date.now()-s;return bt("Profile end ".concat(o," took ").concat(h," ms.")),c},r}});var wt=b(qe=>{"use strict";a();u();Object.defineProperty(qe,"__esModule",{value:!0});qe.AuthorizationRequest=void 0;var On=Ce(),Ln=xe(),Cn=10,qn=function(t){return t.generateRandom(Cn)},Bn=function(){function t(e,r,n){r===void 0&&(r=new On.DefaultCrypto),n===void 0&&(n=!0),this.crypto=r,this.usePkce=n,this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.scope=e.scope,this.responseType=e.response_type||t.RESPONSE_TYPE_CODE,this.state=e.state||qn(r),this.extras=e.extras,this.internal=e.internal}return t.prototype.setupCodeVerifier=function(){var e=this;if(this.usePkce){var r=this.crypto.generateRandom(128),n=this.crypto.deriveChallenge(r).catch(function(o){(0,Ln.log)("Unable to generate PKCE challenge. Not using PKCE",o)});return n.then(function(o){o&&(e.internal=e.internal||{},e.internal.code_verifier=r,e.extras=e.extras||{},e.extras.code_challenge=o,e.extras.code_challenge_method="S256")})}else return Promise.resolve()},t.prototype.toJson=function(){var e=this;return this.setupCodeVerifier().then(function(){return{response_type:e.responseType,client_id:e.clientId,redirect_uri:e.redirectUri,scope:e.scope,state:e.state,extras:e.extras,internal:e.internal}})},t.RESPONSE_TYPE_TOKEN="token",t.RESPONSE_TYPE_CODE="code",t}();qe.AuthorizationRequest=Bn});var Tr=b(Be=>{"use strict";a();u();Object.defineProperty(Be,"__esModule",{value:!0});Be.requireValidUrl=void 0;var Fn=pe();function Dn(t){try{return new URL(t),t}catch{throw new Fn.AppAuthError("Invalid input url ".concat(t))}}Be.requireValidUrl=Dn});var Et=b(q=>{"use strict";a();u();Object.defineProperty(q,"__esModule",{value:!0});q.AuthorizationRequestHandler=q.BUILT_IN_PARAMETERS=q.AuthorizationNotifier=void 0;var Tt=xe(),Hn=Tr(),Nn=function(){function t(){this.listener=null}return t.prototype.setAuthorizationListener=function(e){this.listener=e},t.prototype.onAuthorizationComplete=function(e,r,n){this.listener&&this.listener(e,r,n)},t}();q.AuthorizationNotifier=Nn;q.BUILT_IN_PARAMETERS=["redirect_uri","client_id","response_type","state","scope"];var jn=function(){function t(e,r){this.utils=e,this.crypto=r,this.notifier=null}return t.prototype.buildRequestUrl=function(e,r){var n={redirect_uri:r.redirectUri,client_id:r.clientId,response_type:r.responseType,state:r.state,scope:r.scope};if(r.extras)for(var o in r.extras)r.extras.hasOwnProperty(o)&&q.BUILT_IN_PARAMETERS.indexOf(o)<0&&(n[o]=r.extras[o]);var i=this.utils.stringify(n),s=(0,Hn.requireValidUrl)(e.authorizationEndpoint),c="".concat(s,"?").concat(i);return c},t.prototype.completeAuthorizationRequestIfPossible=function(){var e=this;return(0,Tt.log)("Checking to see if there is an authorization response to be delivered."),this.notifier||(0,Tt.log)(`Notifier is not present on AuthorizationRequest handler.
          No delivery of result will be possible`),this.completeAuthorizationRequest().then(function(r){r||(0,Tt.log)("No result is available yet."),r&&e.notifier&&e.notifier.onAuthorizationComplete(r.request,r.response,r.error)})},t.prototype.setAuthorizationNotifier=function(e){return this.notifier=e,this},t}();q.AuthorizationRequestHandler=jn});var vt=b(fe=>{"use strict";a();u();Object.defineProperty(fe,"__esModule",{value:!0});fe.AuthorizationError=fe.AuthorizationResponse=void 0;var Mn=function(){function t(e){this.code=e.code,this.state=e.state}return t.prototype.toJson=function(){return{code:this.code,state:this.state}},t}();fe.AuthorizationResponse=Mn;var Wn=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri,this.state=e.state}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri,state:this.state}},t}();fe.AuthorizationError=Wn});var De=b(k=>{"use strict";a();u();var Rt=k&&k.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(k,"__esModule",{value:!0});k.TestRequestor=k.FetchRequestor=k.JQueryRequestor=k.Requestor=void 0;var _t=pe(),Fe=function(){function t(){}return t}();k.Requestor=Fe;var Kn=function(t){Rt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){var n=$.ajax(r);return new Promise(function(o,i){n.then(function(s,c,h){o(s)},function(s,c,h){i(new _t.AppAuthError(h))})})},e}(Fe);k.JQueryRequestor=Kn;var Jn=function(t){Rt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){if(!r.url)return Promise.reject(new _t.AppAuthError("A URL must be provided."));var n=new URL(r.url),o={};if(o.method=r.method,o.mode="cors",r.data)if(r.method&&r.method.toUpperCase()==="POST")o.body=r.data;else{var i=new URLSearchParams(r.data);i.forEach(function(h,d){n.searchParams.append(d,h)})}if(o.headers={},r.headers)for(var s in r.headers)r.headers.hasOwnProperty(s)&&(o.headers[s]=r.headers[s]);var c=r.dataType&&r.dataType.toLowerCase()==="json";return c&&(o.headers.Accept="application/json, text/javascript, */*; q=0.01"),fetch(n.toString(),o).then(function(h){if(h.status>=200&&h.status<300){var d=h.headers.get("content-type");return c||d&&d.indexOf("application/json")!==-1?h.json():h.text()}else return Promise.reject(new _t.AppAuthError(h.status.toString(),h.statusText))})},e}(Fe);k.FetchRequestor=Jn;var zn=function(t){Rt(e,t);function e(r){var n=t.call(this)||this;return n.promise=r,n}return e.prototype.xhr=function(r){return this.promise},e}(Fe);k.TestRequestor=zn});var Er=b(He=>{"use strict";a();u();Object.defineProperty(He,"__esModule",{value:!0});He.AuthorizationServiceConfiguration=void 0;var $n=De(),Qn=".well-known",Vn="openid-configuration",Gn=function(){function t(e){this.authorizationEndpoint=e.authorization_endpoint,this.tokenEndpoint=e.token_endpoint,this.revocationEndpoint=e.revocation_endpoint,this.userInfoEndpoint=e.userinfo_endpoint,this.endSessionEndpoint=e.end_session_endpoint}return t.prototype.toJson=function(){return{authorization_endpoint:this.authorizationEndpoint,token_endpoint:this.tokenEndpoint,revocation_endpoint:this.revocationEndpoint,end_session_endpoint:this.endSessionEndpoint,userinfo_endpoint:this.userInfoEndpoint}},t.fetchFromIssuer=function(e,r){var n="".concat(e,"/").concat(Qn,"/").concat(Vn),o=r||new $n.JQueryRequestor;return o.xhr({url:n,dataType:"json",method:"GET"}).then(function(i){return new t(i)})},t}();He.AuthorizationServiceConfiguration=Gn});var je=b(Ne=>{"use strict";a();u();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.BasicQueryStringUtils=void 0;var Yn=function(){function t(){}return t.prototype.parse=function(e,r){return r?this.parseQueryString(e.hash):this.parseQueryString(e.search)},t.prototype.parseQueryString=function(e){var r={};e=e.trim().replace(/^(\?|#|&)/,"");for(var n=e.split("&"),o=0;o<n.length;o+=1){var i=n[o],s=i.split("=");if(s.length>=2){var c=decodeURIComponent(s.shift()),h=s.length>0?s.join("="):null;h&&(r[c]=decodeURIComponent(h))}}return r},t.prototype.stringify=function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&e[n]&&r.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e[n])));return r.join("&")},t}();Ne.BasicQueryStringUtils=Yn});var kt=b(W=>{"use strict";a();u();var Xn=W&&W.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(W,"__esModule",{value:!0});W.LocalStorageBackend=W.StorageBackend=void 0;var vr=function(){function t(){}return t}();W.StorageBackend=vr;var Zn=function(t){Xn(e,t);function e(r){var n=t.call(this)||this;return n.storage=r||self.localStorage,n}return e.prototype.getItem=function(r){var n=this;return new Promise(function(o,i){var s=n.storage.getItem(r);o(s||null)})},e.prototype.removeItem=function(r){var n=this;return new Promise(function(o,i){n.storage.removeItem(r),o()})},e.prototype.clear=function(){var r=this;return new Promise(function(n,o){r.storage.clear(),n()})},e.prototype.setItem=function(r,n){var o=this;return new Promise(function(i,s){o.storage.setItem(r,n),i()})},e}(vr);W.LocalStorageBackend=Zn});var kr=b(de=>{"use strict";a();u();var eo=de&&de.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(de,"__esModule",{value:!0});de.RedirectRequestHandler=void 0;var to=wt(),ro=Et(),_r=vt(),no=Ce(),Me=xe(),oo=je(),io=kt(),Ut=function(t){return"".concat(t,"_appauth_authorization_request")},Rr=function(t){return"".concat(t,"_appauth_authorization_service_configuration")},It="appauth_current_authorization_request",so=function(t){eo(e,t);function e(r,n,o,i){r===void 0&&(r=new io.LocalStorageBackend),n===void 0&&(n=new oo.BasicQueryStringUtils),o===void 0&&(o=self.location),i===void 0&&(i=new no.DefaultCrypto);var s=t.call(this,n,i)||this;return s.storageBackend=r,s.locationLike=o,s}return e.prototype.performAuthorizationRequest=function(r,n){var o=this,i=this.crypto.generateRandom(10),s=Promise.all([this.storageBackend.setItem(It,i),n.toJson().then(function(c){return o.storageBackend.setItem(Ut(i),JSON.stringify(c))}),this.storageBackend.setItem(Rr(i),JSON.stringify(r.toJson()))]);s.then(function(){var c=o.buildRequestUrl(r,n);(0,Me.log)("Making a request to ",n,c),o.locationLike.assign(c)})},e.prototype.completeAuthorizationRequest=function(){var r=this;return this.storageBackend.getItem(It).then(function(n){return n?r.storageBackend.getItem(Ut(n)).then(function(o){return JSON.parse(o)}).then(function(o){return new to.AuthorizationRequest(o)}).then(function(o){var i="".concat(r.locationLike.origin).concat(r.locationLike.pathname),s=r.utils.parse(r.locationLike,!0),c=s.state,h=s.code,d=s.error;(0,Me.log)("Potential authorization request ",i,s,c,h,d);var y=c===o.state,f=null,A=null;if(y){if(d){var m=s.error_uri,R=s.error_description;A=new _r.AuthorizationError({error:d,error_description:R,error_uri:m,state:c})}else f=new _r.AuthorizationResponse({code:h,state:c});return Promise.all([r.storageBackend.removeItem(It),r.storageBackend.removeItem(Ut(n)),r.storageBackend.removeItem(Rr(n))]).then(function(){return(0,Me.log)("Delivering authorization response"),{request:o,response:f,error:A}})}else return(0,Me.log)("Mismatched request (state and request_uri) dont match."),Promise.resolve(null)}):null})},e}(ro.AuthorizationRequestHandler);de.RedirectRequestHandler=so});var Ur=b(We=>{"use strict";a();u();Object.defineProperty(We,"__esModule",{value:!0});We.RevokeTokenRequest=void 0;var ao=function(){function t(e){this.token=e.token,this.tokenTypeHint=e.token_type_hint,this.clientId=e.client_id,this.clientSecret=e.client_secret}return t.prototype.toJson=function(){var e={token:this.token};return this.tokenTypeHint&&(e.token_type_hint=this.tokenTypeHint),this.clientId&&(e.client_id=this.clientId),this.clientSecret&&(e.client_secret=this.clientSecret),e},t.prototype.toStringMap=function(){var e=this.toJson();return e},t}();We.RevokeTokenRequest=ao});var Ir=b(K=>{"use strict";a();u();Object.defineProperty(K,"__esModule",{value:!0});K.TokenRequest=K.GRANT_TYPE_REFRESH_TOKEN=K.GRANT_TYPE_AUTHORIZATION_CODE=void 0;K.GRANT_TYPE_AUTHORIZATION_CODE="authorization_code";K.GRANT_TYPE_REFRESH_TOKEN="refresh_token";var uo=function(){function t(e){this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.grantType=e.grant_type,this.code=e.code,this.refreshToken=e.refresh_token,this.extras=e.extras}return t.prototype.toJson=function(){return{grant_type:this.grantType,code:this.code,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,client_id:this.clientId,extras:this.extras}},t.prototype.toStringMap=function(){var e={grant_type:this.grantType,client_id:this.clientId,redirect_uri:this.redirectUri};if(this.code&&(e.code=this.code),this.refreshToken&&(e.refresh_token=this.refreshToken),this.extras)for(var r in this.extras)this.extras.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=this.extras[r]);return e},t}();K.TokenRequest=uo});var Pt=b(C=>{"use strict";a();u();Object.defineProperty(C,"__esModule",{value:!0});C.TokenError=C.TokenResponse=C.nowInSeconds=void 0;var co=10*60*-1,ho=function(){return Math.round(new Date().getTime()/1e3)};C.nowInSeconds=ho;var po=function(){function t(e){this.accessToken=e.access_token,this.tokenType=e.token_type||"bearer",e.expires_in&&(this.expiresIn=parseInt(e.expires_in,10)),this.refreshToken=e.refresh_token,this.scope=e.scope,this.idToken=e.id_token,this.issuedAt=e.issued_at||(0,C.nowInSeconds)()}return t.prototype.toJson=function(){var e;return{access_token:this.accessToken,id_token:this.idToken,refresh_token:this.refreshToken,scope:this.scope,token_type:this.tokenType,issued_at:this.issuedAt,expires_in:(e=this.expiresIn)===null||e===void 0?void 0:e.toString()}},t.prototype.isValid=function(e){if(e===void 0&&(e=co),this.expiresIn){var r=(0,C.nowInSeconds)();return r<this.issuedAt+this.expiresIn+e}else return!0},t}();C.TokenResponse=po;var fo=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri}},t}();C.TokenError=fo});var Sr=b(Ke=>{"use strict";a();u();Object.defineProperty(Ke,"__esModule",{value:!0});Ke.BaseTokenRequestHandler=void 0;var lo=pe(),yo=je(),Pr=Pt(),go=De(),mo=function(){function t(e,r){e===void 0&&(e=new go.JQueryRequestor),r===void 0&&(r=new yo.BasicQueryStringUtils),this.requestor=e,this.utils=r}return t.prototype.isTokenResponse=function(e){return e.error===void 0},t.prototype.performRevokeTokenRequest=function(e,r){var n=this.requestor.xhr({url:e.revocationEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return n.then(function(o){return!0})},t.prototype.performTokenRequest=function(e,r){var n=this,o=this.requestor.xhr({url:e.tokenEndpoint,method:"POST",dataType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return o.then(function(i){return n.isTokenResponse(i)?new Pr.TokenResponse(i):Promise.reject(new lo.AppAuthError(i.error,new Pr.TokenError(i)))})},t}();Ke.BaseTokenRequestHandler=mo});var Lr=b(Or=>{"use strict";a();u();Object.defineProperty(Or,"__esModule",{value:!0})});var St=b(g=>{"use strict";a();u();var Ao=g&&g.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),w=g&&g.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ao(e,t,r)};Object.defineProperty(g,"__esModule",{value:!0});w(wt(),g);w(Et(),g);w(vt(),g);w(Er(),g);w(Ce(),g);w(pe(),g);w(At(),g);w(xe(),g);w(je(),g);w(kr(),g);w(Ur(),g);w(kt(),g);w(Ir(),g);w(Sr(),g);w(Pt(),g);w(Lr(),g);w(De(),g)});a();u();var ie=ne(Vr()),Qt=(0,ie.createContext)(null);function Yr({children:t,authRepository:e}){return ie.default.createElement(Qt.Provider,{value:e},t)}function H(){let t=(0,ie.useContext)(Qt);if(!t)throw new Error("useAuthRepository must be used within an AuthProvider");return t}function O(){return H().useUser()}a();u();a();u();var yt=ne(Wt());a();u();var st="https://phantom.app",at="https://api.phantom.app/oauth2/auth",_e={prod:"a61bc25e-0c4f-4ab3-aa54-b50ec746eea2",staging:"fe26708b-7db7-4146-9fbb-9a9736acfb2b"},Re={prod:"https://auth.phantom.app",staging:"https://staging-auth.phantom.app"},Vt="/login/start",Gt="/oauth2/token";var Xr="https://help.phantom.com/hc/en-us/articles/32367778944403";var Yt=ge({minutes:60})-ge({minutes:15}),G="/v1/authentication-keys";a();u();var se=t=>Buffer.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");a();u();a();u();a();u();a();u();var Xt=null;function Zr(t){Xt=t}function Zt(){return Xt}function er(t){let e=Zt();if(e){let r=new Headers(t);return r.set("X-Phantom-AnonymousId",e),r}return t}a();u();var ut=null;function ct(t){ut=t}async function ht(t=!1){if(!ut)throw new Error("No fetch bearer token function registered. Register one with registerFetchBearerToken().");return await ut(t)}a();u();a();u();function tr(...t){let e=new AbortController;for(let r of t){let n=r instanceof AbortController?r.signal:r;if(n?.aborted)return e.abort(n.reason),e.signal;n?.addEventListener("abort",()=>{e.abort(n.reason)},{once:!0})}return e.signal}var en=2*60*1e3,tn=[];function rr(t,e){let{fetchTimeout:r,retryDelays:n,retryOnAuthTokenExpiration:o,onAuthRetry:i,...s}=e||{},c=e?.fetchTimeout??en,h=e?.retryDelays??tn,d=0,y=0,f=s;return new Promise((A,m)=>{function R(){d++,y=Date.now();let Q=!0,S=new AbortController,ot=fetch(t,{...f,signal:tr(...s.signal?[s.signal,S.signal]:[S.signal])}),Mt=setTimeout(()=>{S.abort(),Q=!1,nt(d)?E():m(new Error(`fetchWithTimeoutAndRetry(): Failed to get response from server due to timeout of ${c} ms, tried ${d} times.`))},c);ot.then(D=>{clearTimeout(Mt),Q&&(D.status>=200&&D.status<300?A(D):nt(d,D.status)?D.status===401&&o&&i?i(f).then(it=>{f=it,E()}).catch(it=>{m(it)}):E():A(D))}).catch(D=>{clearTimeout(Mt),nt(d)?E():m(D)})}function E(){let Q=h[d-1],S=y+Q;setTimeout(R,Math.max(S-Date.now(),0))}function nt(Q,S){if(S===401&&o)return Q<=h.length;let ot=S?S>=400&&S<=499:!1;return Q<=h.length&&!ot}R()})}a();u();var ke=(t={},e={})=>{let r=new Headers(t),n=new Headers(e);for(let[o,i]of n.entries())i===void 0||i==="undefined"?r.delete(o):r.set(o,i);return r};a();u();var ce=ne(Wt());a();u();a();u();function nr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function pt(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function or(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");nr(t.outputLen),nr(t.blockLen)}function ae(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ir(t,e){pt(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}a();u();a();u();var Ue=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var sr=t=>t instanceof Uint8Array;var Ie=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),I=(t,e)=>t<<32-e|t>>>e,rn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!rn)throw new Error("Non little-endian hardware is not supported");function nn(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function me(t){if(typeof t=="string"&&(t=nn(t)),!sr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Ci(...t){let e=new Uint8Array(t.reduce((n,o)=>n+o.length,0)),r=0;return t.forEach(n=>{if(!sr(n))throw new Error("Uint8Array expected");e.set(n,r),r+=n.length}),e}var ue=class{clone(){return this._cloneInto()}},qi={}.toString;function ar(t){let e=n=>t().update(me(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Bi(t=32){if(Ue&&typeof Ue.getRandomValues=="function")return Ue.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}var Pe=class extends ue{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,or(e);let n=me(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return ae(this),this.iHash.update(e),this}digestInto(e){ae(this),pt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ft=(t,e,r)=>new Pe(t,e).update(r).digest();ft.create=(t,e)=>new Pe(t,e);a();u();a();u();function on(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),c=Number(r&i),h=n?4:0,d=n?0:4;t.setUint32(e+h,s,n),t.setUint32(e+d,c,n)}var Se=class extends ue{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ie(this.buffer)}update(e){ae(this);let{view:r,buffer:n,blockLen:o}=this;e=me(e);let i=e.length;for(let s=0;s<i;){let c=Math.min(o-this.pos,i-s);if(c===o){let h=Ie(e);for(;o<=i-s;s+=o)this.process(h,s);continue}n.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ae(this),ir(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let f=s;f<o;f++)r[f]=0;on(n,o-8,BigInt(this.length*8),i),this.process(n,0);let c=Ie(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let d=h/4,y=this.get();if(d>y.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<d;f++)c.setUint32(4*f,y[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%r&&e.buffer.set(n),e}};var sn=(t,e,r)=>t&e^~t&r,an=(t,e,r)=>t&e^t&r^e&r,un=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),N=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),j=new Uint32Array(64),dt=class extends Se{constructor(){super(64,32,8,!1),this.A=N[0]|0,this.B=N[1]|0,this.C=N[2]|0,this.D=N[3]|0,this.E=N[4]|0,this.F=N[5]|0,this.G=N[6]|0,this.H=N[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:s,G:c,H:h}=this;return[e,r,n,o,i,s,c,h]}set(e,r,n,o,i,s,c,h){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)j[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let A=j[f-15],m=j[f-2],R=I(A,7)^I(A,18)^A>>>3,E=I(m,17)^I(m,19)^m>>>10;j[f]=E+j[f-7]+R+j[f-16]|0}let{A:n,B:o,C:i,D:s,E:c,F:h,G:d,H:y}=this;for(let f=0;f<64;f++){let A=I(c,6)^I(c,11)^I(c,25),m=y+A+sn(c,h,d)+un[f]+j[f]|0,E=(I(n,2)^I(n,13)^I(n,22))+an(n,o,i)|0;y=d,d=h,h=c,c=s+m|0,s=i,i=o,o=n,n=m+E|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,h=h+this.F|0,d=d+this.G|0,y=y+this.H|0,this.set(n,o,i,s,c,h,d,y)}roundClean(){j.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var ur=ar(()=>new dt);var cn=[86,120,48,81,89,86,110,49,100,114,111,113,49,70,56,84,77,115,80,81,66,75,72,51,90,83,110,100,110,116,68,88,107,118,83,53,102,80,114,89,111,88,85,75,57,43,67,57,97,103,74,113,68,76,112,112,100,48,102,101,80,122,83,111,108,113,75,90,56,114,66,70,119,87,84,104,98,57,110,119,43,79,70,51,51,65,61,61],hn=[87,67,49,81,97,71,70,117,100,71,57,116,81,88,86,48,97,70,82,118,97,50,86,117],pn=[87,67,49,81,97,71,70,117,100,71,57,116,84,109,57,117,89,50,85,61];function fn(t){let e=new URL(t);return e.pathname+e.search}function cr(t,e){let r=fn(t),n=JSON.stringify(Math.floor(Date.now()/1e3)),o=r+n,i=ft(ur,ce.Buffer.from(String.fromCharCode(...cn)),ce.Buffer.from(o)),s=new Headers(e);return s.set(ce.Buffer.from(String.fromCharCode(...hn),"base64").toString(),encodeURIComponent(ce.Buffer.from(i).toString("base64"))),s.set(ce.Buffer.from(String.fromCharCode(...pn),"base64").toString(),n),s}var Y=class extends Error{constructor(e,r){super(e),this.response=r}response},dn={"Content-Type":"application/json","X-Phantom-Version":zt,"X-Phantom-Platform":$t},he=async t=>{let e,r;try{r=await t.clone().blob()}catch{}try{e=await t.clone().json()}catch{}let{status:n,statusText:o}=t;return{blob:r,data:e,status:n,statusText:o}},lt=class t{config;constructor(e={}){this.config={withClientAuth:!0,numRetries:0,delayBetweenEachRetryMs:0,timeoutMs:null,validateStatus:!1,headers:dn,withApiEnvironment:"none",fetchBearerToken:!1,...e}}fetch=async(e,r={})=>{try{if(typeof e=="function"){let h=V()==="https://api.phantom.app"?"prod":"staging";e=e({apiEnv:h})}let n="";this.config.withApiEnvironment==="prod"?n="https://api.phantom.app":this.config.withApiEnvironment==="staging"?n="https://staging-api.phantom.app":this.config.withApiEnvironment==="default"?n=V():this.config.withApiEnvironment==="custom"&&this.config.customApiEnv&&(n=this.config.customApiEnv);let o=new URL(`${n}${e}`);r?.params&&(o.search=new URLSearchParams(r.params).toString()),r.headers=ke(this.config.headers,r.headers),r.headers=er(r.headers),this.config.withClientAuth&&(r.headers=cr(o.toString(),r.headers));let i={...r,onAuthRetry:async h=>{let d=await ht(!0);if(d){let y=new Headers(h.headers);return y.set("authorization",`Bearer ${d}`),{...h,headers:y}}return h}},s=this.config.validateStatus;if(r?.validateStatus&&(s=r?.validateStatus),i.body&&typeof i.body!="string"&&(i.body=JSON.stringify(i.body)),this.config.timeoutMs&&(i.fetchTimeout=this.config.timeoutMs),this.config.numRetries&&(i.retryDelays=Array(this.config.numRetries).fill(this.config.delayBetweenEachRetryMs)),this.config.fetchBearerToken){i.retryOnAuthTokenExpiration=!0;let h=await ht();if(h)i.headers=ke(i.headers,{authorization:`Bearer ${h}`});else throw new Y("Unable to get bearer token. Full auth is required.")}let c=await rr(o.toString(),i);if(s&&!c.ok)throw new Y(`Request failed with status code ${c.status}`,await he(c));return c}catch(n){throw n instanceof Y?n:new Y(n?.message,n?.response)}};auth(e){return new t({...this.config,withClientAuth:e})}bearer(e){return typeof e=="string"&&e?this.headers({authorization:`Bearer ${e}`}):typeof e=="boolean"&&e?new t({...this.config,validateStatus:!0,fetchBearerToken:!0,numRetries:1}):this}headers(e,r){let n=r?.mergeHeaders===!1?e:ke(this.config.headers,e);return new t({...this.config,headers:n})}timeout(e){return new t({...this.config,timeoutMs:e})}retry(e,r){return new t({...this.config,numRetries:e,delayBetweenEachRetryMs:r})}validateStatus(e){return new t({...this.config,validateStatus:e})}api(e="default",r){return new t({...this.config,withApiEnvironment:e,customApiEnv:e==="custom"?r:void 0})}async get(e,r={}){r.method="GET";let n=await this.fetch(e,r);return he(n)}async post(e,r,n={}){n.method="POST";let o=await this.fetch(e,{...n,body:r});return he(o)}async put(e,r,n={}){n.method="PUT";let o=await this.fetch(e,{...n,body:r});return he(o)}async patch(e,r,n={}){n.method="PATCH";let o=await this.fetch(e,{...n,body:r});return he(o)}async delete(e,r,n={}){n.method="DELETE";let o=await this.fetch(e,{...n,body:r});return he(o)}},T=new lt;function ln(t){if(t===void 0)throw new Error("rpcUrl undefined");return async(e,r)=>{let n={jsonrpc:"2.0",id:+new Date,method:e,params:r},i=(await T.post(t,n)).data;if("error"in i)throw new Error(JSON.stringify(i.error));return i.result}}async function yn(t,e={}){return T.fetch(t,e)}function Ae(t){return t.status>199&&t.status<400}function gn(t){return t instanceof Y}var mn="https://time.phantom.app/utc",An=l.number().int().positive();async function X(){let t;try{let e=await T.get(mn);if(e.status!==200)throw new Error("Failed to fetch time from server");t=An.parse(e.data)}catch{t=Date.now()}return Math.floor(t/1e3)}var xn=60,bn=()=>Math.floor(Date.now()/1e3);async function Z(t=!0){let e={alg:"ES256",type:"JWT"},r=t?await X():bn(),n={iss:st,aud:at,nbf:r,exp:r+xn,iat:r};return{header:e,payload:n}}function ee(t){let e=se(yt.Buffer.from(JSON.stringify(t.header))),r=se(yt.Buffer.from(JSON.stringify(t.payload)));return[e,r,t.signature].join(".")}a();u();var pr=l.object({alg:l.string(),type:l.string(),kid:l.string()}),fr=l.object({sub:l.string(),iss:l.string(),aud:l.string(),nbf:l.number(),exp:l.number(),iat:l.number()}),wn=l.object({header:pr,payload:fr,signature:l.string()}),dr=l.object({alg:l.string(),type:l.string()}),lr=l.object({iss:l.string(),aud:l.string(),nbf:l.number(),exp:l.number(),iat:l.number()}),Tn=l.object({header:dr,payload:lr}),gt=l.object({id_token:l.string(),access_token:l.string(),refresh_token:l.string(),scope:l.string(),token_type:l.string(),expires_in:l.number().gte(0)}),En=l.object({redirectTo:l.string()}),yr=l.object({at_hash:l.string(),aud:l.array(l.string()),auth_time:l.number(),exp:l.number(),iat:l.number(),iss:l.string(),jti:l.string(),rat:l.number(),sid:l.string(),sub:l.string(),email:l.string().optional()}),Oe=l.object({authenticationKeys:l.array(l.object({createdAt:l.string().datetime().nullish().default(null),updatedAt:l.string().datetime().nullish().default(null),id:l.string().uuid(),publicKey:l.string(),userId:l.string().uuid()})).optional()});a();u();var te=ne(St());a();u();a();u();a();u();a();u();function Ot(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function xo(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Cr(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function bo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ot(t.outputLen),Ot(t.blockLen)}function wo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function To(t,e){Cr(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Eo={number:Ot,bool:xo,bytes:Cr,hash:bo,exists:wo,output:To},Je=Eo;a();u();a();u();var vo={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var $e=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),P=(t,e)=>t<<32-e|t>>>e,_o=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!_o)throw new Error("Non little-endian hardware is not supported");var $a=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ro(t){if(typeof t!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof t}`);return new TextEncoder().encode(t)}function Lt(t){if(typeof t=="string"&&(t=Ro(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}var ze=class{clone(){return this._cloneInto()}};function Ct(t){let e=n=>t().update(Lt(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ko(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(r>>o&i),c=Number(r&i),h=n?4:0,d=n?0:4;t.setUint32(e+h,s,n),t.setUint32(e+d,c,n)}var Qe=class extends ze{constructor(e,r,n,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$e(this.buffer)}update(e){Je.exists(this);let{view:r,buffer:n,blockLen:o}=this;e=Lt(e);let i=e.length;for(let s=0;s<i;){let c=Math.min(o-this.pos,i-s);if(c===o){let h=$e(e);for(;o<=i-s;s+=o)this.process(h,s);continue}n.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Je.exists(this),Je.output(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let f=s;f<o;f++)r[f]=0;ko(n,o-8,BigInt(this.length*8),i),this.process(n,0);let c=$e(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let d=h/4,y=this.get();if(d>y.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<d;f++)c.setUint32(4*f,y[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%r&&e.buffer.set(n),e}};var Uo=(t,e,r)=>t&e^~t&r,Io=(t,e,r)=>t&e^t&r^e&r,Po=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),J=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),z=new Uint32Array(64),Ve=class extends Qe{constructor(){super(64,32,8,!1),this.A=J[0]|0,this.B=J[1]|0,this.C=J[2]|0,this.D=J[3]|0,this.E=J[4]|0,this.F=J[5]|0,this.G=J[6]|0,this.H=J[7]|0}get(){let{A:e,B:r,C:n,D:o,E:i,F:s,G:c,H:h}=this;return[e,r,n,o,i,s,c,h]}set(e,r,n,o,i,s,c,h){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)z[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let A=z[f-15],m=z[f-2],R=P(A,7)^P(A,18)^A>>>3,E=P(m,17)^P(m,19)^m>>>10;z[f]=E+z[f-7]+R+z[f-16]|0}let{A:n,B:o,C:i,D:s,E:c,F:h,G:d,H:y}=this;for(let f=0;f<64;f++){let A=P(c,6)^P(c,11)^P(c,25),m=y+A+Uo(c,h,d)+Po[f]+z[f]|0,E=(P(n,2)^P(n,13)^P(n,22))+Io(n,o,i)|0;y=d,d=h,h=c,c=s+m|0,s=i,i=o,o=n,n=m+E|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,h=h+this.F|0,d=d+this.G|0,y=y+this.H|0,this.set(n,o,i,s,c,h,d,y)}roundClean(){z.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},qt=class extends Ve{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},qr=Ct(()=>new Ve),ou=Ct(()=>new qt);var le=ne(St()),Br=ne(Gr()),Bt={generateRandom:t=>{let e=(0,Br.randomBytes)(t);return(0,le.bufferToString)(e)},async deriveChallenge(t){let e=qr((0,le.textEncodeLite)(t));return(0,le.urlSafe)(e)}};a();u();var U=()=>{let t=V();return t==="https://staging-api.phantom.app"?Re.staging:t==="https://api.phantom.app"?Re.prod:p.BASE_AUTH_ENDPOINT||Re.staging},Ft=()=>`${U()}${Vt}`,Ge=()=>`${U()}${Gt}`;var Fr=new te.BasicQueryStringUtils;async function be(t,e){let{url:r,codeVerifier:n}=await Dr(t.getClientID(),t.redirectURL,e),o=e.type==="email",i=await t.fetchAuthorizationCode(t.redirectURL,r,o);return await Dt({grantType:"authorization_code",clientID:t.getClientID(),redirectURI:t.redirectURL,tokenEndpoint:Ge(),code:i,codeVerifier:n})}async function Dr(t,e,r){let n=Ft(),o,i=["openid","offline_access","user","incognito","seedless"],s;switch(r.type){case"key":{o={type:"key",jwt:ee(r.clientJWT)};break}case"email":{o={type:"email",provider:r.provider,existingAccessToken:r.existingAccessToken},s=r.prompt,i.push("email");break}case"session":{o={type:"session",existingAccessToken:r.existingAccessToken};break}}let h=await new te.AuthorizationRequest({client_id:t,redirect_uri:e,scope:i.join(" "),response_type:"code"},Bt).toJson(),d;switch(o.type){case"key":d=`jwt:${se(Buffer.from(o.jwt,"utf8"))}`;break;case"email":d=`sso:${o.provider}`,o.existingAccessToken&&(d=`${d}:${o.existingAccessToken}`);break;case"session":d=`session:${o.existingAccessToken}`;break}let y={redirect_uri:h.redirect_uri,client_id:h.client_id,response_type:h.response_type,state:h.state??"",scope:h.scope,login_hint:d};s&&(y.prompt=s);let f=h.extras?.code_challenge,A=h.extras?.code_challenge_method,m=h.internal?.code_verifier;if(f&&A&&(y.code_challenge=f,y.code_challenge_method=A),!f||!A||!m)throw new Error("Missing code challenge or code verifier for PKCE.");let R=Fr.stringify(y);return{url:`${n}?${R}`,codeVerifier:m}}async function Dt(t){let{grantType:e,tokenEndpoint:r,clientID:n,redirectURI:o}=t,i;e==="authorization_code"?i=new te.TokenRequest({client_id:n,redirect_uri:o,grant_type:e,code:t.code,extras:{code_verifier:t.codeVerifier}}):i=new te.TokenRequest({client_id:n,redirect_uri:o,grant_type:e,refresh_token:t.refreshToken});let s=await T.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).auth(Jt()).post(r,Fr.stringify(i.toStringMap()));So(s,e);let c=gt.safeParse(s.data);if(!c.success)throw new Error("Invalid OAuth2Token response.");let{data:h}=c,d=await X();return{idToken:h.id_token,accessToken:h.access_token,refreshToken:h.refresh_token,scope:h.scope,tokenType:h.token_type,expiresAt:(d+h.expires_in)*1e3}}async function Ye(t,e){return await Dt({clientID:t.getClientID(),redirectURI:t.redirectURL,grantType:"refresh_token",tokenEndpoint:Ge(),refreshToken:e})}function So(t,e){if([401,400].includes(t.status)){let r="";if(t.status===401)switch(r="Token Request Unauthorized (401): ",e){case"authorization_code":r+="Authorization code is expired or invalid.";break;case"refresh_token":r+="Refresh token is expired or invalid.";break;default:r+=`Unknown grant type [${e}]. `}if(t.status===400)switch(r="Bad Token Request (400): ",e){case"authorization_code":r="for [authorization_code]. Possible causes: 1. The authorization code is expired or invalid. 2. Redirect URI mismatch. 3. Code verifier mismatch (if using PKCE).";break;case"refresh_token":r="for [refresh_token]. Possible causes: 1. The refresh token is expired, invalid, or revoked. 2. Client ID mismatch. 3. Missing or malformed refresh token in the request.";break;default:r=`for unknown grant type [${e}]. Check the payload and OAuth provider documentation.`}throw new Error(r)}}a();u();a();u();a();u();var we=class{subscribers={};subscribe(e,r){return this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(r),()=>{this.subscribers[e].splice(this.subscribers[e].indexOf(r),1)}}emitEvent(e,...r){(this.subscribers[e]??[]).forEach(o=>o(...r))}};var Xe=class extends we{emit(e){e&&(this.emitEvent("user",e),this.emitEvent("userID",e.userID),this.emitEvent("accessToken",e.accessToken),e.email&&this.emitEvent("email",e.email))}emitLoggedOut(){this.emitEvent("loggedOut")}};a();u();a();u();function B(t,e="expected value not found"){if(t==null)throw new Error(e);return t}function Hr(t,e="expected value not found"){if(!t)throw new Error(e)}var Ze=async(t,e)=>{let r=U(),n=B(t.signer,"Signer is required for key-based auth."),o=await n.getAuthenticationPublicKey(e),i=await Z(t.isServerTimeEnabled()),s=await n.sign(i,e),c=await T.get(`${r}${G}`,{params:{token:ee(s)}});if(!Ae(c))throw new Error("Failed to get authentication keys: response is not okay");let h=c.data;return(Oe.parse(h).authenticationKeys??[]).some(f=>f.publicKey===o)};a();u();a();u();var Nr=async t=>{try{let e=await T.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).bearer(t).get(`${U()}/userinfo`);return Ae(e)}catch{return!1}};a();u();var Ht=".phantom.auth",F=`${Ht}.tokens`,jr=`${Ht}.authentication-factors`,Lo=`${Ht}.email-provider`;a();u();a();u();var Mr=t=>Buffer.from(t.replace("-","+").replace("_","/").replace(/=+$/,""),"base64");var re=t=>{let e=t.idToken.split(".");if(e.length!==3)throw new Error("Malformed ID token. Expected 3 period-delimited parts to ID token.");let r;try{let n=Mr(e[1]).toString("utf-8"),o=JSON.parse(n);r=yr.parse(o)}catch{throw new Error("Unable to parse ID token payload.")}return{accessToken:t.accessToken,userID:r.sub,email:r.email}};a();u();var Wr="@phantom/auth",_={user:["auth",`${Wr}:user`],authFactors:["auth",`${Wr}:user-auth-factors`]};a();u();var rt=async(t,e,r)=>{let{storage:n,authConfig:o}=t,i,{type:s}=r;switch(s){case"key":{let h=B(t.signer,"Signer is required for key-based auth."),d=await Z(t.isServerTimeEnabled()),y=await h.sign(d,r.secretIdentifier);i=await be(o,{type:s,clientJWT:y});break}case"email":{i=await be(o,{type:s,prompt:r.prompt,provider:r.provider});break}case"session":{i=await be(o,{type:s,existingAccessToken:r.accessToken});break}}x.addBreadcrumb("\u2705 Login succeeded!","Auth","debug"),await n.set(F,i);let c=re(i);return await t.queryClient.setQueryData(_.user,c),e.emit(c),c};var Kr={queryKey:_.user,gcTime:Yt,staleTime:ge({minutes:5})},ye=async(t,e)=>await t.queryClient.fetchQuery({...Kr,queryFn:()=>zr(t,e)}),Jr=(t,e)=>oe({...Kr,queryFn:async()=>{let r=await zr(t,e);if(!r)throw new Error("Unable to log in.");return r},retryOnMount:!1}),zr=async(t,e)=>{let r=async()=>{let n=await Co(t);return n||(t.signer?await qo(t,e):null)};return t.runExclusive(async()=>{let n=await r();return e.emit(n),n})};async function Co({storage:t,authConfig:e,isLocalTokenValidityCheckEnabled:r}){let n=await t.get(F);if(!n)return null;let o=r(),i=!1;if(o){let s=await X()+10,c=Math.floor(n.expiresAt/1e3);i=s<c}else i=await Nr(n.accessToken);if(i)return x.addBreadcrumb(`\u267B\uFE0F Access token still valid => Expires at ${n.expiresAt}`,"Auth","debug"),re(n);if(n.refreshToken)try{let s=await Ye(e,n.refreshToken);return x.addBreadcrumb(`\u2705 Refreshed auth token => Expires at ${s.expiresAt}`,"Auth","debug"),await t.set(F,s),re(s)}catch(s){return x.addBreadcrumb("Error refreshing auth token.","Auth","error"),x.captureError(s,"Auth"),null}return null}async function qo(t,e){let n=await B(t.signer,"Unable to log in with key-based auth. Signer is not available.").getAllSecretIdentifiers();if(n.length===0)return x.addBreadcrumb("Unable to log in with key-based auth. Vault is not yet onboarded or has no secrets that can perform key-based auth.","Auth","info"),null;let o;try{for(let i of n)if(await Ze(t,i)){o=i;break}}catch(i){throw x.addBreadcrumb("Unable to log in with key-based auth. Error checking auth factors.","Auth","error"),i}if(!o)return x.addBreadcrumb("Unable to log in with key-based auth. No auth factor found for login.","Auth","info"),null;try{return await rt(t,e,{type:"key",secretIdentifier:o})}catch(i){throw x.addBreadcrumb("Unable to log in with key-based auth. Error performing auth.","Auth","error"),i}}a();u();var Bo=async t=>{await t.removeQueries({queryKey:_.user})},Fo=async t=>{await t.resetQueries({queryKey:_.user})},Nt=async t=>{await t.invalidateQueries({queryKey:_.user})},Te=async t=>{await t.invalidateQueries({queryKey:_.authFactors})};var Do=t=>{let e=new Xe,r={getUser:()=>ye(t,e),useUser:()=>Jr(t,e),refreshTokens:()=>Ho(t),logIn:n=>rt(t,e,n),isExistingAuthFactor:n=>Ze(t,n),getAuthenticationKeys:()=>No(t,e),getLocalAuthenticationPublicKeys:()=>jo(t),addAuthFactor:n=>Mo(t,e,n),deleteAuthFactor:n=>Wo(t,e,n),deleteAllAuthFactors:()=>Ko(t,e),subscribe:(n,o)=>e.subscribe(n,o),logOut:()=>Jo(t,e)};return ct(async(n=!1)=>(n&&await Nt(t.queryClient),(await r.getUser())?.accessToken??null)),r},Ho=async t=>{let e=await t.storage.get(F);if(!e)return!1;let r=await Ye(t.authConfig,e.refreshToken);return await t.storage.set(F,r),await t.queryClient.setQueryData(_.user,re(r)),!0},No=async(t,e)=>({authenticationPublicKeys:(await $r(t,e)).map(n=>n.publicKey)}),$r=async(t,e)=>{let r=U(),n=await ye(t,e);if(!n)throw new Error("User not authenticated.");let{data:o}=await T.bearer(n.accessToken).get(`${r}${G}`),i=Oe.safeParse(o);if(!i.success)throw new Error("Unable to parse auth factors response.");return i.data.authenticationKeys??[]},jo=async t=>{try{let e=B(t.signer,"Signer is required for key-based auth."),r=await e.getAllSecretIdentifiers(),n={};for(let o of r)n[o]=await e.getAuthenticationPublicKey(o);return n}catch{return{}}},Mo=async(t,e,{secretIdentifier:r})=>{let n=U(),o=B(t.signer,"Signer is required for key-based auth."),i=await ye(t,e);if(!i)throw new Error("User not authenticated.");let s=await Z(t.isServerTimeEnabled()),c=await o.sign(s,r);await T.bearer(i.accessToken).post(`${n}${G}`,{jwt:ee(c)})},Wo=async(t,e,{authenticationPublicKey:r})=>{let n=U(),o=await ye(t,e);if(!o)throw new Error("User not authenticated.");await T.bearer(o.accessToken).delete(`${n}${G}/${encodeURIComponent(r)}`)},Ko=async(t,e)=>{let r=U(),n=t.storage,o=await ye(t,e);if(!o)throw new Error("User not authenticated.");let i=await $r(t,e);await Promise.all(i.map(s=>T.bearer(o.accessToken).delete(`${r}${G}/${s.id}`))),await n.remove(jr)},Jo=async({storage:t},e)=>{await t.remove(F),e.emitLoggedOut()};a();u();var zo=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let n=r.searchParams.get("code");if(!n)throw new Error("No authorization code");return n};a();u();var $o=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let n=r.searchParams.get("error"),o=r.searchParams.get("error_description");if(n)throw new Error(`${n}: ${o}`,{cause:n});return!1};a();u();var Qo=()=>V()==="https://api.phantom.app"?_e.prod:_e.staging;a();u();var Vo=()=>{let t=H(),{data:e}=O(),r=_.authFactors;return oe({queryKey:r,queryFn:async()=>{let o=await t.getLocalAuthenticationPublicKeys();if(Object.keys(o).length===0)return{};let i=[];try{if(e){let{authenticationPublicKeys:c=[]}=await t.getAuthenticationKeys();i=c}}catch(c){c instanceof Error&&x.addBreadcrumb("Auth",`Unable to fetch existing AuthFactors for user (${e?.userID}): ${c.message}`,"error")}let s={};for(let[c,h]of Object.entries(o)){let d=i.includes(h);!d&&await t.isExistingAuthFactor(c)||(s[c]={authenticationPublicKey:h,isExistingAuthFactor:d})}return Object.keys(s).length===0&&x.addBreadcrumb("Auth",`Unable to build AuthFactors map: 
- user: ${e?.userID}
- locally available auth factors: ${Object.keys(o).length}
- auth factors registered with user: ${i.length}`,"error"),s},retryOnMount:!1})};a();u();a();u();var jt=()=>{let{data:t}=O();return!!t};function Go(t,e){let r=jt(),n;return t.enabled===void 0?n=r:typeof t.enabled=="function"?n=o=>(Hr(typeof t.enabled=="function","expected enabled to be a function"),r&&t.enabled(o)):typeof t.enabled=="boolean"?n=r&&t.enabled:Kt(t.enabled),oe({...t,enabled:n},e)}a();u();var Yo=()=>{let t=Ee(),e=H(),r=async({secretIdentifier:n})=>{await e.addAuthFactor({secretIdentifier:n}),await Te(t)};return ve({mutationFn:async n=>{try{return await r(n)}catch(o){x.addBreadcrumb("Auth",`Could not add auth factor: ${n.secretIdentifier}`,"error");let i;throw o instanceof Error?i=o:i=new Error(`Could not add auth factor: ${n.secretIdentifier}`),x.captureError(i,"Auth"),i}}})};a();u();var Xo=()=>{let t=Ee(),e=H(),r=async({authenticationPublicKey:n})=>{await e.deleteAuthFactor({authenticationPublicKey:n}),await Te(t)};return ve({mutationFn:async n=>{try{return await r(n)}catch(o){x.addBreadcrumb("Auth","Could not remove auth factor!","error");let i;throw o instanceof Error?i=o:i=new Error("Could not remove auth factor!"),x.captureError(i,"Auth"),i}}})};a();u();var Zo=()=>{let{data:t}=O();return t?.accessToken};a();u();a();u();var ei=()=>{let{data:t}=O();return t?.email};export{Zr as a,Zt as b,Ci as c,ar as d,Bi as e,ft as f,Se as g,ur as h,T as i,ln as j,yn as k,Ae as l,gn as m,st as n,at as o,Xr as p,se as q,wn as r,Tn as s,U as t,we as u,Lo as v,Bo as w,Fo as x,Nt as y,Te as z,Do as A,zo as B,$o as C,Yr as D,H as E,O as F,Qo as G,Vo as H,jt as I,Go as J,Yo as K,Xo as L,Zo as M,ei as N};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-46FGAK6J.js.map
